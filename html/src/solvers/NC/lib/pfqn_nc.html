<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of pfqn_nc</title>
  <meta name="keywords" content="pfqn_nc">
  <meta name="description" content="">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../../index.html">Home</a> &gt;  <a href="#">src</a> &gt; <a href="../../index.html">solvers</a> &gt; <a href="../index.html">NC</a> &gt; <a href="index.html">lib</a> &gt; pfqn_nc.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../../index.html"><img alt="<" border="0" src="../../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for src\solvers\NC\lib&nbsp;<img alt=">" border="0" src="../../../../right.png"></a></td></tr></table>-->

<h1>pfqn_nc
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong></strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>function [lGn] = pfqn_nc(L,N,Z,varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="pfqn_le.html" class="code" title="function [Gn,lGn]=pfqn_le(L,N,Z)">pfqn_le</a>	PFQN_LE Asymptotic solution of closed product-form queueing networks by</li><li><a href="pfqn_ls.html" class="code" title="function [Gn,lGn]=pfqn_ls(L,N,Z,I)">pfqn_ls</a>	PFQN_MCI Approximate solution of closed product-form queueing networks</li><li><a href="pfqn_mci.html" class="code" title="function [G,lG,lZ] = pfqn_mci(D,N,Z,I,variant)">pfqn_mci</a>	gmvamcint - normalizing constant estimation via Monte Carlo Integration</li><li><a href="pfqn_mva.html" class="code" title="function [XN,QN,UN,CN,lGN] = pfqn_mva(L,N,Z,mi)">pfqn_mva</a>	[XN,QN,UN,CN] = pfqn_mva(L,N,Z,mi)</li><li><a href="pfqn_panacea.html" class="code" title="function [Gn,lGn]=pfqn_pnc(L,K,Z)">pfqn_panacea</a>	K = population vector</li><li><a href="pfqn_pnc2.html" class="code" title="function logG = pfqn_pnc2(L,N,Z)">pfqn_pnc2</a>	</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="pfqn_gmvald.html" class="code" title="function [G,lG]=pfqn_gmvald(L,N,mu,options)">pfqn_gmvald</a>	G=pfqn_gmvald(L,N,mu)</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function lG = sub_method(L,N,Z,options)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [lGn] = pfqn_nc(L,N,Z,varargin)</a>
0002 options = Solver.parseOptions(varargin,SolverNC.defaultOptions);
0003 
0004 <span class="comment">% remove empty classes</span>
0005 nnzClasses = find(N);
0006 L = L(:,nnzClasses);
0007 N = N(:,nnzClasses);
0008 Z = Z(:,nnzClasses);
0009 Lsum = sum(L,2);
0010 Lmax = max(L,[],2);
0011 L = L((Lmax./Lsum)&gt;options.tol,:); <span class="comment">% remove stations with no demand</span>
0012 LZsum = sum(L,1) + sum(Z,1);
0013 <span class="keyword">if</span> any(N(LZsum == 0)&gt;0) <span class="comment">% if there is a class with jobs but L and Z all zero</span>
0014     error(<span class="string">'The specified model is impossible: no station has positive demands in one of the non-empty classes.'</span>);
0015 <span class="keyword">end</span>
0016 [M,K]=size(L);
0017 
0018 <span class="comment">% return immediately if degenerate case</span>
0019 <span class="keyword">if</span> isempty(L) || sum(L(:))&lt;options.tol <span class="comment">% all demands are zero</span>
0020     <span class="keyword">if</span> isempty(Z) || sum(Z(:))&lt;options.tol
0021         lGn = 0;
0022     <span class="keyword">else</span>
0023         lGn = - sum(factln(N)) + sum(N.*log(sum(Z,1)));
0024     <span class="keyword">end</span>
0025     <span class="keyword">return</span>
0026 <span class="keyword">elseif</span> M==1 &amp;&amp; (isempty(Z) || sum(Z(:))&lt;options.tol) <span class="comment">% single node and no think time</span>
0027     lGn = factln(sum(N)) - sum(factln(N)) + sum(N.*log(sum(L,1)));
0028     <span class="keyword">return</span>
0029 <span class="keyword">end</span>
0030 
0031 <span class="comment">% contribution from jobs that permanently loop at delay</span>
0032 zeroDemandClasses = find(sum(L,1)&lt;options.tol); <span class="comment">% all jobs in delay</span>
0033 nonzeroDemandClasses = setdiff(1:K, zeroDemandClasses);
0034 <span class="keyword">if</span> sum(Z(:),1)&lt;options.tol || isempty(Z)
0035     lGz = 0;
0036 <span class="keyword">else</span>
0037     <span class="keyword">if</span> isempty(zeroDemandClasses) <span class="comment">% for old MATLAB release compatibility</span>
0038         lGz = 0;
0039     <span class="keyword">else</span>
0040         Nz = N(zeroDemandClasses);
0041         lGz = - sum(factln(Nz)) + sum(Nz.*log(sum(Z(:,zeroDemandClasses),1)));
0042     <span class="keyword">end</span>
0043 <span class="keyword">end</span>
0044 Lnnzd = L(:,nonzeroDemandClasses);
0045 Nnnzd = N(nonzeroDemandClasses);
0046 Znnzd = Z(:,nonzeroDemandClasses);
0047 
0048 
0049 <span class="comment">% first try rather efficient methods</span>
0050 <span class="keyword">if</span> M==1 <span class="comment">% single node</span>
0051     <span class="keyword">if</span> (K==1 &amp;&amp; N&lt;30) || strcmp(options.method,<span class="string">'exact'</span>)
0052         options.method = <span class="string">'exact'</span>;
0053         logI = <a href="#_sub1" class="code" title="subfunction lG = sub_method(L,N,Z,options)">sub_method</a>(Lnnzd, Nnnzd, Znnzd, options);
0054         lGn =  lGz + logI;
0055         <span class="keyword">return</span>
0056     <span class="keyword">end</span>
0057     
0058     Nstar = (sum(Lnnzd)+sum(Znnzd,1))/max(Lnnzd);
0059     <span class="keyword">if</span> strcmpi(options.method,<span class="string">'default'</span>) &amp;&amp; sum(Nnnzd) &gt; 5 * sum(Nstar)
0060         options.method = <span class="string">'le'</span>;
0061         logI = <a href="#_sub1" class="code" title="subfunction lG = sub_method(L,N,Z,options)">sub_method</a>(Lnnzd, Nnnzd, Znnzd, options);
0062         <span class="keyword">if</span> isfinite(logI)
0063             lGn =  lGz + logI;
0064             <span class="keyword">return</span>;
0065         <span class="keyword">end</span>
0066     <span class="keyword">end</span>
0067     
0068     <span class="comment">% cycle solution methods</span>
0069     <span class="comment">% 'pnc' excluded because if one of the Zs is zero produces bad results</span>
0070     methods = {<span class="string">'pnc2'</span>,<span class="string">'imci'</span>};
0071     <span class="keyword">if</span> options.samples &lt; 1e5
0072         <span class="keyword">if</span> options.verbose == 2
0073             warning(<span class="string">'options.samples value is too low for SolverNC. Setting to 1e5.'</span>);
0074         <span class="keyword">end</span>
0075         options.samples = 1e5;
0076     <span class="keyword">end</span>
0077     <span class="keyword">for</span> m=1:length(methods)
0078         options.method = methods{m};
0079         logI = <a href="#_sub1" class="code" title="subfunction lG = sub_method(L,N,Z,options)">sub_method</a>(Lnnzd, Nnnzd, Znnzd, options);
0080         <span class="keyword">if</span> isfinite(logI)
0081             lGn =  lGz + logI;
0082             <span class="keyword">return</span>;
0083         <span class="keyword">end</span>
0084     <span class="keyword">end</span>
0085     <span class="keyword">return</span>
0086 <span class="keyword">else</span> <span class="comment">% not a repairmen problem</span>
0087     Nstar = (sum(Lnnzd)+sum(Znnzd,1))/max(Lnnzd);
0088     <span class="keyword">if</span> strcmpi(options.method,<span class="string">'default'</span>) &amp;&amp; sum(Nnnzd) &gt; 5 * sum(Nstar)
0089         options.method = <span class="string">'le'</span>;
0090     <span class="keyword">end</span>    
0091     lGn = <a href="#_sub1" class="code" title="subfunction lG = sub_method(L,N,Z,options)">sub_method</a>(Lnnzd, Nnnzd, Znnzd, options);
0092 <span class="keyword">end</span>
0093 <span class="keyword">end</span>
0094 
0095 <a name="_sub1" href="#_subfunctions" class="code">function lG = sub_method(L,N,Z,options)</a>
0096 <span class="keyword">switch</span> options.method
0097     <span class="keyword">case</span> {<span class="string">'mmint'</span>,<span class="string">'pnc2'</span>}
0098         <span class="keyword">if</span> size(L,1)&gt;1
0099             error(<span class="string">'The %s method requires a model with a delay and a queueing station.'</span>,options.method);
0100         <span class="keyword">end</span>
0101         lG = <a href="pfqn_pnc2.html" class="code" title="function logG = pfqn_pnc2(L,N,Z)">pfqn_pnc2</a>(L,N,sum(Z,1));
0102     <span class="keyword">case</span> {<span class="string">'pana'</span>,<span class="string">'panacea'</span>,<span class="string">'pnc'</span>}
0103         [~,lG] = <a href="pfqn_panacea.html" class="code" title="function [Gn,lGn]=pfqn_pnc(L,K,Z)">pfqn_panacea</a>(L,N,sum(Z,1));
0104     <span class="keyword">case</span> <span class="string">'le'</span>
0105         [~,lG] = <a href="pfqn_le.html" class="code" title="function [Gn,lGn]=pfqn_le(L,N,Z)">pfqn_le</a>(L,N,sum(Z,1));
0106     <span class="keyword">case</span> <span class="string">'ls'</span>
0107         [~,lG] = <a href="pfqn_ls.html" class="code" title="function [Gn,lGn]=pfqn_ls(L,N,Z,I)">pfqn_ls</a>(L,N,sum(Z,1),options.samples);
0108     <span class="keyword">case</span> {<span class="string">'default'</span>,<span class="string">'mci'</span>,<span class="string">'imci'</span>}
0109         [~,lG] = <a href="pfqn_mci.html" class="code" title="function [G,lG,lZ] = pfqn_mci(D,N,Z,I,variant)">pfqn_mci</a>(L,N,sum(Z,1),options.samples,<span class="string">'imci'</span>); <span class="comment">% repairmen</span>
0110     <span class="keyword">case</span> {<span class="string">'exact'</span>,<span class="string">'mva'</span>}
0111         [~,~,~,~,lG] = <a href="pfqn_mva.html" class="code" title="function [XN,QN,UN,CN,lGN] = pfqn_mva(L,N,Z,mi)">pfqn_mva</a>(L,N,sum(Z,1));
0112 <span class="keyword">end</span>
0113 <span class="keyword">return</span>
0114 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Tue 19-Mar-2019 14:07:48 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>