<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of SolverCTMC</title>
  <meta name="keywords" content="SolverCTMC">
  <meta name="description" content="">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="#">src</a> &gt; <a href="../index.html">solvers</a> &gt; <a href="index.html">CTMC</a> &gt; SolverCTMC.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for src\solvers\CTMC&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>SolverCTMC
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong></strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>This is a script file. </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="SolverCTMC.html" class="code" title="">SolverCTMC</a>	</li><li><a href="solver_ctmc_analysis.html" class="code" title="function [QN,UN,RN,TN,CN,XN,runtime,fname] = solver_ctmc_analysis(qn, options)">solver_ctmc_analysis</a>	Copyright (c) 2012-2019, Imperial College London</li><li><a href="solver_ctmc_joint.html" class="code" title="function [Pnir,runtime,fname] = solver_ctmc_joint(qn, options)">solver_ctmc_joint</a>	Copyright (c) 2012-2019, Imperial College London</li><li><a href="solver_ctmc_marg.html" class="code" title="function [Pnir,runtime,fname] = solver_ctmc_marg(qn, options)">solver_ctmc_marg</a>	Copyright (c) 2012-2019, Imperial College London</li><li><a href="solver_ctmc_transient_analysis.html" class="code" title="function [t,QNt,UNt,RNt,TNt,CNt,XNt,runtime,fname] = solver_ctmc_transient_analysis(qn, options)">solver_ctmc_transient_analysis</a>	Copyright (c) 2012-2019, Imperial College London</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="SolverCTMC.html" class="code" title="">SolverCTMC</a>	</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function self = SolverCTMC(model,varargin)</a></li><li><a href="#_sub2" class="code">function supported = getSupported(self,supported)</a></li><li><a href="#_sub3" class="code">function runtime = run(self)</a></li><li><a href="#_sub4" class="code">function Pnir = getProbState(self, ist)</a></li><li><a href="#_sub5" class="code">function Pn = getProbSysState(self)</a></li><li><a href="#_sub6" class="code">function featSupported = getFeatureSet()</a></li><li><a href="#_sub7" class="code">function [bool, featSupported, featUsed] = supports(model)</a></li><li><a href="#_sub8" class="code">function options = defaultOptions()</a></li><li><a href="#_sub9" class="code">function printInfGen(Q,SS)</a></li><li><a href="#_sub10" class="code">function printEventFilt(sync,D,SS,myevents)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 classdef <a href="SolverCTMC.html" class="code" title="">SolverCTMC</a> &lt; NetworkSolver
0002 <span class="comment">% Copyright (c) 2012-2019, Imperial College London</span>
0003 <span class="comment">% All rights reserved.</span>
0004     
0005     methods
0006         <a name="_sub0" href="#_subfunctions" class="code">function self = SolverCTMC(model,varargin)</a>
0007             self = self@NetworkSolver(model, mfilename);
0008             self.setOptions(Solver.parseOptions(varargin, self.defaultOptions));
0009         <span class="keyword">end</span>
0010         
0011         <a name="_sub1" href="#_subfunctions" class="code">function supported = getSupported(self,supported)</a>
0012             <span class="keyword">if</span> ~exist(<span class="string">'supported'</span>,<span class="string">'var'</span>)
0013                 supported=struct();
0014             <span class="keyword">end</span>
0015         <span class="keyword">end</span>
0016                 
0017         <a name="_sub2" href="#_subfunctions" class="code">function runtime = run(self)</a>
0018             T0=tic;
0019             
0020             options = self.getOptions;
0021             
0022             <span class="keyword">if</span> ~isinf(options.timespan(1)) &amp;&amp; (options.timespan(1) == options.timespan(2))
0023                 warning(<span class="string">'%s: timespan is a single point, spacing by options.tol (%e).\n'</span>,mfilename, options.tol);
0024                 options.timespan(2) = options.timespan(1) + options.tol;
0025             <span class="keyword">end</span>
0026             
0027             rand(<span class="string">'seed'</span>,options.seed); 
0028             
0029             <span class="keyword">if</span> ~self.supports(self.model)
0030 <span class="comment">%                if options.verbose</span>
0031                     error(<span class="string">'Line:FeatureNotSupportedBySolver'</span>,<span class="string">'This model contains features not supported by the %s solver.'</span>,mfilename);
0032 <span class="comment">%                end</span>
0033 <span class="comment">%                runtime = toc(T0);</span>
0034 <span class="comment">%                return</span>
0035             <span class="keyword">end</span>
0036             
0037             qn = self.getStruct();
0038             <span class="keyword">if</span> any(isinf(qn.njobs))
0039                 <span class="keyword">if</span> isinf(options.cutoff)
0040                     error(<span class="string">'Line:UnspecifiedOption'</span>,<span class="string">'The model has open chains, it is mandatory to specify a finite cutoff value, e.g., SolverCTMC(model,''cutoff'',1).'</span>);
0041                 <span class="keyword">end</span>
0042             <span class="keyword">end</span>
0043             
0044             M = qn.nstations;
0045             K = qn.nclasses;
0046             NK = qn.njobs;
0047             sizeEstimator = 0;
0048             <span class="keyword">for</span> k=1:K
0049                 sizeEstimator = sizeEstimator + gammaln(1+NK(k)+M-1) - gammaln(1+M-1) - gammaln(1+NK(k)); <span class="comment">% worst-case estimate of the state space</span>
0050             <span class="keyword">end</span>
0051             <span class="keyword">if</span> sizeEstimator &gt; 6
0052                 <span class="keyword">if</span> ~isfield(options,<span class="string">'force'</span>) || options.force == false
0053                     error(<span class="string">'Line:ModelTooLargeToSolve'</span>,<span class="string">'CTMC size may be too large to solve. Stopping SolverCTMC. Set options.force=true to bypass this control.\n'</span>);
0054                     runtime=toc(T0);
0055                     <span class="keyword">return</span>
0056                 <span class="keyword">end</span>
0057             <span class="keyword">end</span>
0058             
0059             <span class="comment">% we compute all metrics anyway because CTMC has essentially</span>
0060             <span class="comment">% the same cost</span>
0061             <span class="keyword">if</span> isinf(options.timespan(1))
0062                 [Q,U,R,T,C,X,~,fname] = <a href="solver_ctmc_analysis.html" class="code" title="function [QN,UN,RN,TN,CN,XN,runtime,fname] = solver_ctmc_analysis(qn, options)">solver_ctmc_analysis</a>(qn, options);
0063                 runtime=toc(T0);
0064                 self.setAvgResults(Q,U,R,T,C,X,runtime);
0065                 self.result.kept_model = fname;
0066             <span class="keyword">else</span>
0067                 lastSol= [];
0068                 [s0, s0prior] = self.model.getState;
0069                 s0_sz = cellfun(@(x) size(x,1), s0)';
0070                 s0_id = pprod(s0_sz-1);
0071                 <span class="keyword">while</span> s0_id&gt;=0 <span class="comment">% for all possible initial states</span>
0072                     s0prior_val = 1;
0073                     <span class="keyword">for</span> ind=1:qn.nnodes
0074                         <span class="keyword">if</span> qn.isstateful(ind)
0075                             isf = qn.nodeToStateful(ind);
0076                             s0prior_val = s0prior_val * s0prior{isf}(1+s0_id(isf)); <span class="comment">% update prior</span>
0077                             qn.state{isf} = s0{isf}(1+s0_id(isf),:); <span class="comment">% assign initial state to network</span>
0078                         <span class="keyword">end</span>
0079                     <span class="keyword">end</span>
0080                     <span class="keyword">if</span> s0prior_val &gt; 0
0081                         [t,Qfull_t,Ufull_t,~,Tfull_t,~,~,~,~] = <a href="solver_ctmc_transient_analysis.html" class="code" title="function [t,QNt,UNt,RNt,TNt,CNt,XNt,runtime,fname] = solver_ctmc_transient_analysis(qn, options)">solver_ctmc_transient_analysis</a>(qn, options);
0082                         <span class="keyword">if</span> isempty(self.result) || ~isfield(self.result,<span class="string">'TranAvg'</span>) || ~isfield(self.result.TranAvg,<span class="string">'Q'</span>)
0083                             self.result.TranAvg.Q = cell(M,K);
0084                             self.result.TranAvg.U = cell(M,K);
0085                             self.result.TranAvg.T = cell(M,K);
0086                             <span class="keyword">for</span> i=1:M
0087                                 <span class="keyword">for</span> r=1:K
0088                                     self.result.TranAvg.Q{i,r} = [Qfull_t{i,r} * s0prior_val,t];
0089                                     self.result.TranAvg.U{i,r} = [Ufull_t{i,r} * s0prior_val,t];
0090                                     self.result.TranAvg.T{i,r} = [Tfull_t{i,r} * s0prior_val,t];
0091                                 <span class="keyword">end</span>
0092                             <span class="keyword">end</span>
0093                         <span class="keyword">else</span>
0094                             <span class="keyword">for</span> i=1:M
0095                                 <span class="keyword">for</span> r=1:K
0096                                     tunion = union(self.result.TranAvg.Q{i,r}(:,2), t);
0097                                     dataOld = interp1(self.result.TranAvg.Q{i,r}(:,2),self.result.TranAvg.Q{i,r}(:,1),tunion);
0098                                     dataNew = interp1(t,Qfull_t{i,r},tunion);
0099                                     self.result.TranAvg.Q{i,r} = [dataOld+s0prior_val*dataNew,tunion];
0100                                     
0101                                     dataOld = interp1(self.result.TranAvg.U{i,r}(:,2),self.result.TranAvg.U{i,r}(:,1),tunion);
0102                                     dataNew = interp1(t,Ufull_t{i,r},tunion);
0103                                     self.result.TranAvg.U{i,r} = [dataOld+s0prior_val*dataNew,tunion];
0104                                     
0105                                     dataOld = interp1(self.result.TranAvg.T{i,r}(:,2),self.result.TranAvg.T{i,r}(:,1),tunion);
0106                                     dataNew = interp1(t,Tfull_t{i,r},tunion);
0107                                     self.result.TranAvg.T{i,r} = [dataOld+s0prior_val*dataNew,tunion];
0108                                 <span class="keyword">end</span>
0109                             <span class="keyword">end</span>
0110                         <span class="keyword">end</span>
0111                     <span class="keyword">end</span>
0112                     s0_id=pprod(s0_id,s0_sz-1); <span class="comment">% update initial state</span>
0113                 <span class="keyword">end</span>
0114                 runtime = toc(T0);
0115                 self.result.(<span class="string">'solver'</span>) = self.getName();
0116                 self.result.runtime = runtime;
0117                 self.result.solverSpecific = lastSol;
0118             <span class="keyword">end</span>
0119         <span class="keyword">end</span>
0120             
0121         <a name="_sub3" href="#_subfunctions" class="code">function Pnir = getProbState(self, ist)</a>
0122             <span class="keyword">if</span> ~exist(<span class="string">'ist'</span>,<span class="string">'var'</span>)
0123                 error(<span class="string">'getProbState requires to indicate the station of interest.'</span>);
0124             <span class="keyword">end</span>
0125             <span class="keyword">if</span> ~isfield(self.options,<span class="string">'keep'</span>)
0126                 self.options.keep = false;
0127             <span class="keyword">end</span>
0128             T0 = tic;
0129             qn = self.model.getStruct;
0130             qn.state = self.model.getState;
0131             Pnir = <a href="solver_ctmc_marg.html" class="code" title="function [Pnir,runtime,fname] = solver_ctmc_marg(qn, options)">solver_ctmc_marg</a>(qn, self.options);
0132             self.result.(<span class="string">'solver'</span>) = self.getName();
0133             self.result.Prob.marginal = Pnir;
0134             runtime = toc(T0);
0135             self.result.runtime = runtime;
0136             Pnir = Pnir(ist);
0137         <span class="keyword">end</span>
0138         
0139         <a name="_sub4" href="#_subfunctions" class="code">function Pn = getProbSysState(self)</a>
0140             <span class="keyword">if</span> ~isfield(self.options,<span class="string">'keep'</span>)
0141                 self.options.keep = false;
0142             <span class="keyword">end</span>
0143             T0 = tic;
0144             qn = self.model.getStruct;
0145             <span class="keyword">if</span> self.model.isStateValid 
0146                 Pn = <a href="solver_ctmc_joint.html" class="code" title="function [Pnir,runtime,fname] = solver_ctmc_joint(qn, options)">solver_ctmc_joint</a>(qn, self.options);
0147                 self.result.(<span class="string">'solver'</span>) = self.getName();
0148                 self.result.Prob.joint = Pn;
0149             <span class="keyword">else</span>
0150                 error(<span class="string">'The model state is invalid.'</span>);
0151             <span class="keyword">end</span>
0152             runtime = toc(T0);
0153             self.result.runtime = runtime;
0154         <span class="keyword">end</span>
0155         
0156     <span class="keyword">end</span>
0157     
0158     methods (Static)
0159         <a name="_sub5" href="#_subfunctions" class="code">function featSupported = getFeatureSet()</a>
0160             featSupported = SolverFeatureSet;
0161             featSupported.setTrue({<span class="string">'Source'</span>,<span class="string">'Sink'</span>,<span class="keyword">...</span>
0162                 <span class="string">'ClassSwitch'</span>,<span class="string">'DelayStation'</span>,<span class="string">'Queue'</span>,<span class="keyword">...</span>
0163                 <span class="string">'Cox2'</span>,<span class="string">'Erlang'</span>,<span class="string">'Exponential'</span>,<span class="string">'HyperExp'</span>,<span class="keyword">...</span>
0164                 <span class="string">'StatelessClassSwitcher'</span>,<span class="string">'InfiniteServer'</span>,<span class="string">'SharedServer'</span>,<span class="string">'Buffer'</span>,<span class="string">'Dispatcher'</span>,<span class="keyword">...</span>
0165                 <span class="string">'Server'</span>,<span class="string">'JobSink'</span>,<span class="string">'RandomSource'</span>,<span class="string">'ServiceTunnel'</span>,<span class="keyword">...</span>
0166                 <span class="string">'SchedStrategy_INF'</span>,<span class="string">'SchedStrategy_PS'</span>,<span class="keyword">...</span>
0167                 <span class="string">'SchedStrategy_DPS'</span>,<span class="string">'SchedStrategy_GPS'</span>,<span class="keyword">...</span>
0168                 <span class="string">'SchedStrategy_RAND'</span>,<span class="string">'SchedStrategy_SEPT'</span>,<span class="keyword">...</span>
0169                 <span class="string">'SchedStrategy_LEPT'</span>,<span class="string">'SchedStrategy_FCFS'</span>,<span class="keyword">...</span>
0170                 <span class="string">'SchedStrategy_HOL'</span>,<span class="string">'SchedStrategy_LCFS'</span>,<span class="keyword">...</span>
0171                 <span class="string">'RoutingStrategy_PROB'</span>,<span class="string">'RoutingStrategy_RAND'</span>,<span class="keyword">...</span>
0172                 <span class="string">'ClosedClass'</span>,<span class="string">'OpenClass'</span>,<span class="string">'Replayer'</span>});
0173         <span class="keyword">end</span>        
0174         
0175         <a name="_sub6" href="#_subfunctions" class="code">function [bool, featSupported, featUsed] = supports(model)</a>
0176             featUsed = model.getUsedLangFeatures();    
0177             featSupported = SolverCTMC.getFeatureSet();
0178             bool = SolverFeatureSet.supports(featSupported, featUsed);
0179         <span class="keyword">end</span>
0180     <span class="keyword">end</span>
0181     
0182     methods (Static)
0183         <a name="_sub7" href="#_subfunctions" class="code">function options = defaultOptions()</a>
0184             options = Solver.defaultOptions();
0185             options.timespan = [Inf,Inf];
0186         <span class="keyword">end</span>
0187         
0188         <a name="_sub8" href="#_subfunctions" class="code">function printInfGen(Q,SS)</a>
0189             SS=full(SS);
0190             Q=full(Q);
0191             <span class="keyword">for</span> s=1:size(SS,1)
0192                 <span class="keyword">for</span> sp=1:size(SS,1)
0193                     <span class="keyword">if</span> Q(s,sp)&gt;0
0194                         fprintf(1,<span class="string">'%s-&gt;%s: %f\n'</span>,mat2str(SS(s,:)),mat2str(SS(sp,:)),double(Q(s,sp)));
0195                     <span class="keyword">end</span>
0196                 <span class="keyword">end</span>
0197             <span class="keyword">end</span>
0198         <span class="keyword">end</span>
0199         
0200         <a name="_sub9" href="#_subfunctions" class="code">function printEventFilt(sync,D,SS,myevents)</a>
0201             <span class="keyword">if</span> ~exist(<span class="string">'events'</span>,<span class="string">'var'</span>)
0202                 myevents = 1:length(sync);
0203             <span class="keyword">end</span>
0204             SS=full(SS);
0205             <span class="keyword">for</span> e=myevents
0206                 D{e}=full(D{e});
0207                 <span class="keyword">for</span> s=1:size(SS,1)
0208                     <span class="keyword">for</span> sp=1:size(SS,1)
0209                         <span class="keyword">if</span> D{e}(s,sp)&gt;0
0210                             fprintf(1,<span class="string">'%s-- %d: (%d,%d) =&gt; (%d,%d) --&gt;%s: %f\n'</span>,mat2str(SS(s,:)),e,sync{e}.active{1}.node,sync{e}.active{1}.class,sync{e}.passive{1}.node,sync{e}.passive{1}.class,mat2str(SS(sp,:)),double(D{e}(s,sp)));
0211                         <span class="keyword">end</span>
0212                     <span class="keyword">end</span>
0213                 <span class="keyword">end</span>
0214             <span class="keyword">end</span>
0215         <span class="keyword">end</span>
0216     <span class="keyword">end</span>
0217 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Tue 19-Mar-2019 19:15:18 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>