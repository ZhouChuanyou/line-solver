<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of writeJSIM</title>
  <meta name="keywords" content="writeJSIM">
  <meta name="description" content="Copyright (c) 2012-2019, Imperial College London">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../../index.html">Home</a> &gt;  <a href="#">src</a> &gt; <a href="../../index.html">solvers</a> &gt; <a href="../index.html">JMT</a> &gt; <a href="index.html">@SolverJMT</a> &gt; writeJSIM.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../../index.html"><img alt="<" border="0" src="../../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for src\solvers\JMT\@SolverJMT&nbsp;<img alt=">" border="0" src="../../../../right.png"></a></td></tr></table>-->

<h1>writeJSIM
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>Copyright (c) 2012-2019, Imperial College London</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>function fname = writeJSIM(self) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> Copyright (c) 2012-2019, Imperial College London
 All rights reserved.</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="saveArrivalStrategy.html" class="code" title="function [simDoc, section] = saveArrivalStrategy(self, simDoc, section, currentNode)">saveArrivalStrategy</a>	Copyright (c) 2012-2019, Imperial College London</li><li><a href="saveBufferCapacity.html" class="code" title="function [simDoc, section] = saveBufferCapacity(self, simDoc, section, currentNode)">saveBufferCapacity</a>	Copyright (c) 2012-2019, Imperial College London</li><li><a href="saveClassSwitchStrategy.html" class="code" title="function [simDoc, section] = saveClassSwitchStrategy(self, simDoc, section, currentNode)">saveClassSwitchStrategy</a>	Copyright (c) 2012-2019, Imperial College London</li><li><a href="saveClasses.html" class="code" title="function [simElem, simDoc] = saveClasses(self, simElem, simDoc)">saveClasses</a>	Copyright (c) 2012-2019, Imperial College London</li><li><a href="saveDropStrategy.html" class="code" title="function [simDoc, section] = saveDropStrategy(self, simDoc, section)">saveDropStrategy</a>	Copyright (c) 2012-2019, Imperial College London</li><li><a href="saveForkStrategy.html" class="code" title="function [simDoc, section] = saveForkStrategy(self, simDoc, section, currentNode)">saveForkStrategy</a>	Copyright (c) 2012-2019, Imperial College London</li><li><a href="saveGetStrategy.html" class="code" title="function [simDoc, section] = saveGetStrategy(self, simDoc, section, currentNode)">saveGetStrategy</a>	Copyright (c) 2012-2019, Imperial College London</li><li><a href="saveJoinStrategy.html" class="code" title="function [simDoc, section] = saveJoinStrategy(self, simDoc, section, currentNode)">saveJoinStrategy</a>	Copyright (c) 2012-2019, Imperial College London</li><li><a href="saveLinks.html" class="code" title="function [simElem, simDoc] = saveLinks(self, simElem, simDoc)">saveLinks</a>	Copyright (c) 2012-2019, Imperial College London</li><li><a href="saveLogTunnel.html" class="code" title="function [simDoc, section] = saveLogTunnel(self, simDoc, section, currentNode)">saveLogTunnel</a>	Copyright (c) 2012-2019, Imperial College London</li><li><a href="saveMetrics.html" class="code" title="function [simElem, simDoc] = saveMetrics(self, simElem, simDoc)">saveMetrics</a>	Copyright (c) 2012-2019, Imperial College London</li><li><a href="saveNumberOfServers.html" class="code" title="function [simDoc, section] = saveNumberOfServers(self, simDoc, section, currentNode)">saveNumberOfServers</a>	Copyright (c) 2012-2019, Imperial College London</li><li><a href="savePreemptiveStrategy.html" class="code" title="function [simDoc, section] = savePreemptiveStrategy(self, simDoc, section, currentNode)">savePreemptiveStrategy</a>	Copyright (c) 2012-2019, Imperial College London</li><li><a href="savePreemptiveWeights.html" class="code" title="function [simDoc, section] = savePreemptiveWeights(self, simDoc, section, currentNode)">savePreemptiveWeights</a>	Copyright (c) 2012-2019, Imperial College London</li><li><a href="savePutStrategy.html" class="code" title="function [simDoc, section] = savePutStrategy(self, simDoc, section, currentNode)">savePutStrategy</a>	Copyright (c) 2012-2019, Imperial College London</li><li><a href="saveRoutingStrategy.html" class="code" title="function [simDoc, section] = saveRoutingStrategy(self, simDoc, section, currentNode)">saveRoutingStrategy</a>	Copyright (c) 2012-2019, Imperial College London</li><li><a href="saveServerVisits.html" class="code" title="function [simDoc, section] = saveServerVisits(self, simDoc, section)">saveServerVisits</a>	Copyright (c) 2012-2019, Imperial College London</li><li><a href="saveServiceStrategy.html" class="code" title="function [simDoc, section] = saveServiceStrategy(self, simDoc, section, currentNode)">saveServiceStrategy</a>	Copyright (c) 2012-2019, Imperial College London</li><li><a href="saveXMLHeader.html" class="code" title="function [simElem,simDoc] = saveXMLHeader(self, logPath)">saveXMLHeader</a>	Copyright (c) 2012-2019, Imperial College London</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="SolverJMT.html" class="code" title="">SolverJMT</a>	</li><li><a href="jsimgView.html" class="code" title="function jsimgView(self, options)">jsimgView</a>	Copyright (c) 2012-2019, Imperial College London</li><li><a href="jsimwView.html" class="code" title="function jsimwView(self, options)">jsimwView</a>	Copyright (c) 2012-2019, Imperial College London</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function fname = writeJSIM(self)</a>
0002 <span class="comment">% Copyright (c) 2012-2019, Imperial College London</span>
0003 <span class="comment">% All rights reserved.</span>
0004 [simElem, simDoc] = <a href="saveXMLHeader.html" class="code" title="function [simElem,simDoc] = saveXMLHeader(self, logPath)">saveXMLHeader</a>(self, self.model.getLogPath);
0005 [simElem, simDoc] = <a href="saveClasses.html" class="code" title="function [simElem, simDoc] = saveClasses(self, simElem, simDoc)">saveClasses</a>(self, simElem, simDoc);
0006 
0007 numOfClasses = length(self.model.classes);
0008 numOfStations = length(self.model.nodes);
0009 <span class="keyword">for</span> i=1:(numOfStations)
0010     currentNode = self.model.nodes{i,1};
0011     node = simDoc.createElement(<span class="string">'node'</span>);
0012     node.setAttribute(<span class="string">'name'</span>, currentNode.name);
0013     
0014     nodeSections = getSections(currentNode);
0015     <span class="keyword">for</span> j=1:length(nodeSections)
0016         section = simDoc.createElement(<span class="string">'section'</span>);
0017         currentSection = nodeSections{1,j};
0018         <span class="keyword">if</span> ~isempty(currentSection)
0019             section.setAttribute(<span class="string">'className'</span>, currentSection.className);
0020             <span class="keyword">switch</span> currentSection.className
0021                 <span class="keyword">case</span> <span class="string">'Buffer'</span>
0022                     section.setAttribute(<span class="string">'className'</span>, <span class="string">'Queue'</span>); <span class="comment">%overwrite with JMT class name</span>
0023                     [simDoc, section] = <a href="saveBufferCapacity.html" class="code" title="function [simDoc, section] = saveBufferCapacity(self, simDoc, section, currentNode)">saveBufferCapacity</a>(self, simDoc, section, currentNode);
0024                     [simDoc, section] = <a href="saveDropStrategy.html" class="code" title="function [simDoc, section] = saveDropStrategy(self, simDoc, section)">saveDropStrategy</a>(self, simDoc, section);
0025                     [simDoc, section] = <a href="saveGetStrategy.html" class="code" title="function [simDoc, section] = saveGetStrategy(self, simDoc, section, currentNode)">saveGetStrategy</a>(self, simDoc, section, currentNode);
0026                     [simDoc, section] = <a href="savePutStrategy.html" class="code" title="function [simDoc, section] = savePutStrategy(self, simDoc, section, currentNode)">savePutStrategy</a>(self, simDoc, section, currentNode);
0027                 <span class="keyword">case</span> <span class="string">'Server'</span>
0028                     [simDoc, section] = <a href="saveNumberOfServers.html" class="code" title="function [simDoc, section] = saveNumberOfServers(self, simDoc, section, currentNode)">saveNumberOfServers</a>(self, simDoc, section, currentNode);
0029                     [simDoc, section] = <a href="saveServerVisits.html" class="code" title="function [simDoc, section] = saveServerVisits(self, simDoc, section)">saveServerVisits</a>(self, simDoc, section);
0030                     [simDoc, section] = <a href="saveServiceStrategy.html" class="code" title="function [simDoc, section] = saveServiceStrategy(self, simDoc, section, currentNode)">saveServiceStrategy</a>(self, simDoc, section, currentNode);
0031                 <span class="keyword">case</span> <span class="string">'SharedServer'</span>
0032                     section.setAttribute(<span class="string">'className'</span>, <span class="string">'PSServer'</span>); <span class="comment">%overwrite with JMT class name</span>
0033                     [simDoc, section] = <a href="saveNumberOfServers.html" class="code" title="function [simDoc, section] = saveNumberOfServers(self, simDoc, section, currentNode)">saveNumberOfServers</a>(self, simDoc, section, currentNode);
0034                     [simDoc, section] = <a href="saveServerVisits.html" class="code" title="function [simDoc, section] = saveServerVisits(self, simDoc, section)">saveServerVisits</a>(self, simDoc, section);
0035                     [simDoc, section] = <a href="saveServiceStrategy.html" class="code" title="function [simDoc, section] = saveServiceStrategy(self, simDoc, section, currentNode)">saveServiceStrategy</a>(self, simDoc, section, currentNode);
0036                     [simDoc, section] = <a href="savePreemptiveStrategy.html" class="code" title="function [simDoc, section] = savePreemptiveStrategy(self, simDoc, section, currentNode)">savePreemptiveStrategy</a>(self, simDoc, section, currentNode);
0037                     [simDoc, section] = <a href="savePreemptiveWeights.html" class="code" title="function [simDoc, section] = savePreemptiveWeights(self, simDoc, section, currentNode)">savePreemptiveWeights</a>(self, simDoc, section, currentNode);
0038                 <span class="keyword">case</span> <span class="string">'InfiniteServer'</span>
0039                     section.setAttribute(<span class="string">'className'</span>, <span class="string">'Delay'</span>); <span class="comment">%overwrite with JMT class name</span>
0040                     [simDoc, section] = <a href="saveServiceStrategy.html" class="code" title="function [simDoc, section] = saveServiceStrategy(self, simDoc, section, currentNode)">saveServiceStrategy</a>(self, simDoc, section, currentNode);
0041                 <span class="keyword">case</span> <span class="string">'LogTunnel'</span>
0042                     [simDoc, section] = <a href="saveLogTunnel.html" class="code" title="function [simDoc, section] = saveLogTunnel(self, simDoc, section, currentNode)">saveLogTunnel</a>(self, simDoc, section, currentNode);
0043                 <span class="keyword">case</span> <span class="string">'Dispatcher'</span>
0044                     section.setAttribute(<span class="string">'className'</span>, <span class="string">'Router'</span>); <span class="comment">%overwrite with JMT class name</span>
0045                     [simDoc, section] = <a href="saveRoutingStrategy.html" class="code" title="function [simDoc, section] = saveRoutingStrategy(self, simDoc, section, currentNode)">saveRoutingStrategy</a>(self, simDoc, section, currentNode);
0046                 <span class="keyword">case</span> <span class="string">'StatelessClassSwitcher'</span>
0047                     section.setAttribute(<span class="string">'className'</span>, <span class="string">'ClassSwitch'</span>); <span class="comment">%overwrite with JMT class name</span>
0048                     [simDoc, section] = <a href="saveClassSwitchStrategy.html" class="code" title="function [simDoc, section] = saveClassSwitchStrategy(self, simDoc, section, currentNode)">saveClassSwitchStrategy</a>(self, simDoc, section, currentNode);
0049                 <span class="keyword">case</span> <span class="string">'RandomSource'</span>
0050                     [simDoc, section] = <a href="saveArrivalStrategy.html" class="code" title="function [simDoc, section] = saveArrivalStrategy(self, simDoc, section, currentNode)">saveArrivalStrategy</a>(self, simDoc, section, currentNode);
0051                 <span class="keyword">case</span> <span class="string">'Joiner'</span>
0052                     section.setAttribute(<span class="string">'className'</span>, <span class="string">'Join'</span>); <span class="comment">%overwrite with JMT class name</span>
0053                     [simDoc, section] = <a href="saveJoinStrategy.html" class="code" title="function [simDoc, section] = saveJoinStrategy(self, simDoc, section, currentNode)">saveJoinStrategy</a>(self, simDoc, section, currentNode);
0054                 <span class="keyword">case</span> <span class="string">'Forker'</span>
0055                     section.setAttribute(<span class="string">'className'</span>, <span class="string">'Fork'</span>); <span class="comment">%overwrite with JMT class name</span>
0056                     [simDoc, section] = <a href="saveForkStrategy.html" class="code" title="function [simDoc, section] = saveForkStrategy(self, simDoc, section, currentNode)">saveForkStrategy</a>(self, simDoc, section, currentNode);
0057             <span class="keyword">end</span>
0058             node.appendChild(section);
0059         <span class="keyword">end</span>
0060     <span class="keyword">end</span>
0061     simElem.appendChild(node);
0062 <span class="keyword">end</span>
0063 
0064 [simElem, simDoc] = <a href="saveMetrics.html" class="code" title="function [simElem, simDoc] = saveMetrics(self, simElem, simDoc)">saveMetrics</a>(self, simElem, simDoc);
0065 [simElem, simDoc] = <a href="saveLinks.html" class="code" title="function [simElem, simDoc] = saveLinks(self, simElem, simDoc)">saveLinks</a>(self, simElem, simDoc);
0066 
0067 hasReferenceNodes = 0;
0068 preloadNode = simDoc.createElement(<span class="string">'preload'</span>);
0069 s0 = self.model.getState;
0070 qn = self.model.getStruct;
0071 <span class="keyword">for</span> i=1:numOfStations
0072     isReferenceNode = 0;
0073     currentNode = self.model.nodes{i,1};
0074     <span class="keyword">if</span> i&lt;=self.model.getNumberOfStations &amp;&amp; (~isa(self.model.stations{i},<span class="string">'Source'</span>) &amp;&amp; ~isa(self.model.stations{i},<span class="string">'Sink'</span>) &amp;&amp; ~isa(self.model.stations{i},<span class="string">'Join'</span>))
0075         [~, nir] = State.toMarginal(self.model,qn.stationToNode(i),s0{qn.stationToStateful(i)});
0076         stationPopulationsNode = simDoc.createElement(<span class="string">'stationPopulations'</span>);
0077         stationPopulationsNode.setAttribute(<span class="string">'stationName'</span>, currentNode.name);
0078         <span class="keyword">for</span> r=1:(numOfClasses)
0079             currentClass = self.model.classes{r,1};
0080             <span class="comment">%        if currentClass.isReferenceStation(currentNode)</span>
0081             classPopulationNode = simDoc.createElement(<span class="string">'classPopulation'</span>);
0082             <span class="keyword">switch</span> currentClass.type
0083                 <span class="keyword">case</span> <span class="string">'closed'</span>
0084                     isReferenceNode = 1;
0085                     <span class="comment">%                    classPopulationNode.setAttribute('population', sprintf('%d',currentClass.population));</span>
0086                     classPopulationNode.setAttribute(<span class="string">'population'</span>, sprintf(<span class="string">'%d'</span>,round(nir(r))));
0087                     classPopulationNode.setAttribute(<span class="string">'refClass'</span>, currentClass.name);
0088                     stationPopulationsNode.appendChild(classPopulationNode);
0089             <span class="keyword">end</span>
0090             <span class="comment">%        end</span>
0091         <span class="keyword">end</span>
0092     <span class="keyword">end</span>
0093     <span class="keyword">if</span> isReferenceNode
0094         preloadNode.appendChild(stationPopulationsNode);
0095     <span class="keyword">end</span>
0096     hasReferenceNodes = hasReferenceNodes + isReferenceNode;
0097 <span class="keyword">end</span>
0098 <span class="keyword">if</span> hasReferenceNodes
0099     simElem.appendChild(preloadNode);
0100 <span class="keyword">end</span>
0101 fname = getJSIMTempPath(self);
0102 <span class="keyword">try</span>
0103 xmlwrite(fname, simDoc);
0104 <span class="keyword">catch</span>
0105 javaaddpath(which(<span class="string">'xercesImpl-2.11.0.jar'</span>));
0106 javaaddpath(which(<span class="string">'xml-apis-2.11.0.jar'</span>));
0107 pkg load io;
0108 xmlwrite(fname, simDoc);
0109 <span class="keyword">end</span>
0110 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Tue 19-Mar-2019 19:15:18 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>