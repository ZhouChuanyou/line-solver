<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of parseLogs</title>
  <meta name="keywords" content="parseLogs">
  <meta name="description" content="Copyright (c) 2012-2019, Imperial College London">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../../index.html">Home</a> &gt;  <a href="#">src</a> &gt; <a href="../../index.html">solvers</a> &gt; <a href="../index.html">JMT</a> &gt; <a href="index.html">@SolverJMT</a> &gt; parseLogs.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../../index.html"><img alt="<" border="0" src="../../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for src\solvers\JMT\@SolverJMT&nbsp;<img alt=">" border="0" src="../../../../right.png"></a></td></tr></table>-->

<h1>parseLogs
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>Copyright (c) 2012-2019, Imperial College London</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>function logData = parseLogs(model,isNodeLogged, metric) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> Copyright (c) 2012-2019, Imperial College London
 All rights reserved.</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="SolverJMT.html" class="code" title="">SolverJMT</a>	</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function logData = parseLogs(model,isNodeLogged, metric)</a>
0002 <span class="comment">% Copyright (c) 2012-2019, Imperial College London</span>
0003 <span class="comment">% All rights reserved.</span>
0004 
0005 numOfResources = length(model.stations);
0006 <span class="keyword">for</span> i=1:numOfResources
0007     numOfResources = numOfResources - isa(model.stations{i},<span class="string">'Logger'</span>);
0008 <span class="keyword">end</span>
0009 numOfClasses = length(model.classes);
0010 logData = cell(numOfResources,numOfClasses);
0011 <span class="keyword">for</span> i=1:numOfResources
0012     <span class="keyword">if</span> isNodeLogged(i)
0013         logFileArv = [model.getLogPath,sprintf(<span class="string">'%s-Arv.csv'</span>,model.getNodeNames{i})];
0014         logFileDep = [model.getLogPath,sprintf(<span class="string">'%s-Dep.csv'</span>,model.getNodeNames{i})];
0015         <span class="comment">%% load arrival process</span>
0016         <span class="keyword">if</span> exist(logFileArv,<span class="string">'file'</span>) &amp;&amp; exist(logFileDep,<span class="string">'file'</span>)
0017             <span class="comment">%            logArv=readTable(logFileArv,'Delimiter',';','HeaderLines',1); % raw data</span>
0018             
0019             <span class="comment">%%</span>
0020             <span class="comment">% unclear if this part works fine if user has another local</span>
0021             <span class="comment">% since JMT might write with a different delimiter</span>
0022             fid=fopen(logFileArv);
0023             logArv = textscan(fid, <span class="string">'%s%f%f%s%s%s'</span>, <span class="string">'delimiter'</span>,<span class="string">';'</span>, <span class="string">'headerlines'</span>,1);            
0024             fclose(fid);
0025             jobArvTS = logArv{2};
0026             jobArvID = logArv{3};
0027             jobArvClass = logArv{4};
0028             clear logArv;
0029             
0030             <span class="comment">%%</span>
0031             jobArvClasses = unique(jobArvClass);
0032             jobArvClassID = zeros(length(jobArvClass),1);
0033             <span class="keyword">for</span> c=1:length(jobArvClasses)
0034                 jobArvClassID(find(strcmp(jobArvClasses{c},jobArvClass))) = findstring(model.getClassNames,jobArvClasses{c});
0035                 <span class="comment">%                jobArvClassID(find(strcmp(jobArvClasses{c},jobArvClass)))=c;</span>
0036             <span class="keyword">end</span>
0037             logFileArvMat = [model.getLogPath,filesep,sprintf(<span class="string">'%s-Arv.mat'</span>,model.getNodeNames{i})];
0038             save(logFileArvMat,<span class="string">'jobArvTS'</span>,<span class="string">'jobArvID'</span>,<span class="string">'jobArvClass'</span>,<span class="string">'jobArvClasses'</span>,<span class="string">'jobArvClassID'</span>);
0039             
0040             <span class="comment">%% load departure process</span>
0041             fid=fopen(logFileDep);
0042             logDep = textscan(fid, <span class="string">'%s%f%f%s%s%s'</span>, <span class="string">'delimiter'</span>,<span class="string">';'</span>, <span class="string">'headerlines'</span>,1);
0043             fclose(fid);
0044             jobDepTS = logDep{2};
0045             jobDepID = logDep{3};
0046             jobDepClass = logDep{4};
0047             clear logDep;
0048             
0049             <span class="comment">%             jobDepTS = table2array(logDep(:,2));</span>
0050             <span class="comment">%             jobDepID = table2array(logDep(:,3));</span>
0051             <span class="comment">%             jobDepClass = table2cell(logDep(:,4));</span>
0052             jobDepClasses = unique(jobDepClass);
0053             jobDepClassID = zeros(length(jobDepClass),1);
0054             <span class="keyword">for</span> c=1:length(jobDepClasses)
0055                 jobDepClassID(find(strcmp(jobDepClasses{c},jobDepClass))) = findstring(model.getClassNames,jobDepClasses{c});
0056                 <span class="comment">%                jobDepClassID(find(strcmp(jobDepClasses{c},jobDepClass)))=c;</span>
0057             <span class="keyword">end</span>
0058             logFileDepMat = [model.getLogPath,filesep,sprintf(<span class="string">'%s-Dep.mat'</span>,model.getNodeNames{i})];
0059             save(logFileDepMat,<span class="string">'jobDepTS'</span>,<span class="string">'jobDepID'</span>,<span class="string">'jobDepClass'</span>,<span class="string">'jobDepClasses'</span>,<span class="string">'jobDepClassID'</span>);
0060             
0061             nodePreload = zeros(1,numOfClasses);
0062             <span class="keyword">for</span> r=1:numOfClasses
0063                 <span class="keyword">if</span> strcmpi(model.classes{r}.reference.name,model.stations{i}.name)
0064                     <span class="keyword">switch</span> model.classes{r}.type
0065                         <span class="keyword">case</span> <span class="string">'closed'</span>
0066                             nodePreload(r) = model.classes{r}.population;
0067                     <span class="keyword">end</span>
0068                 <span class="keyword">end</span>
0069             <span class="keyword">end</span>
0070             
0071             <span class="keyword">switch</span> metric
0072                 <span class="keyword">case</span> Metric.QLen
0073                     [nodeState{i}] = SolverJMT.parseTranState(logFileArvMat, logFileDepMat, nodePreload);
0074                     
0075                     <span class="comment">%% save in default data structure</span>
0076                     <span class="keyword">for</span> r=1:numOfClasses <span class="comment">%0:numOfClasses</span>
0077                         logData{i,r} = struct();
0078                         logData{i,r}.t = nodeState{i}(:,1);
0079                         logData{i,r}.QLen = nodeState{i}(:,1+r);
0080                     <span class="keyword">end</span>
0081                 <span class="keyword">case</span> Metric.RespT
0082                     [classResT, jobRespT, jobResTArvTS] = SolverJMT.parseTranRespT(logFileArvMat, logFileDepMat);
0083                     
0084                     <span class="keyword">for</span> r=1:numOfClasses
0085                         logData{i,r} = struct();
0086                         <span class="keyword">if</span> r &lt;= size(classResT,2)
0087                             logData{i,r}.t = jobResTArvTS;
0088                             logData{i,r}.RespT = classResT{r};
0089                             <span class="comment">%logData{i,r}.PassT = jobRespT;</span>
0090                         <span class="keyword">else</span>
0091                             logData{i,r}.t = [];
0092                             logData{i,r}.RespT = [];
0093                             <span class="comment">%logData{i,r}.PassT = [];</span>
0094                         <span class="keyword">end</span>
0095                     <span class="keyword">end</span>
0096             <span class="keyword">end</span>
0097         <span class="keyword">end</span>
0098     <span class="keyword">end</span>
0099 <span class="keyword">end</span>
0100 <span class="keyword">end</span>
0101</pre></div>
<hr><address>Generated on Tue 19-Mar-2019 19:15:18 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>