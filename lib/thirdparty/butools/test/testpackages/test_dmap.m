clear all
run('/home/gabor/github/butools/Matlab/BuToolsInit.m')

disp('---BuTools: DMAP package test file---');
disp('Enable the verbose messages with the BuToolsVerbose flag');
global BuToolsVerbose;
BuToolsVerbose = true;
disp('Enable input parameter checking with the BuToolsCheckInput flag');
global BuToolsCheckInput;
BuToolsCheckInput = true;
global BuToolsCheckPrecision;
format short g;
disp('========================================')
disp('Testing BuTools function MarginalDistributionFromDMAP')
disp('Input:');
disp('------');
D0 = [0, 0.02, 0, 0; 0, 0.17, 0.2, 0.14; 0.16, 0.17, 0.02, 0.18; 0, 0, 0, 0.12];
disp('D0 = ');
disp(D0);
D1 = [0, 0.88, 0.1, 0; 0.18, 0.07, 0.14, 0.1; 0.13, 0.15, 0.15, 0.04; 0.31, 0.18, 0.12, 0.27];
disp('D1 = ');
disp(D1);
disp('Test:');
disp('-----');
disp('[a, A] = MarginalDistributionFromDMAP(D0, D1);:');
[a, A] = MarginalDistributionFromDMAP(D0, D1);
disp('a = ');
disp(a);
disp('A = ');
disp(A);
assert(length(a)==size(D0,1)&&CheckDPHRepresentation(a, A), 'MarginalDistributionFromDMAP returned a wrong DPH representation!');
disp('========================================')
disp('Testing BuTools function MarginalMomentsFromDMAP')
disp('Input:');
disp('------');
D0 = [0, 0.02, 0, 0; 0, 0.17, 0.2, 0.14; 0.16, 0.17, 0.02, 0.18; 0, 0, 0, 0.12];
disp('D0 = ');
disp(D0);
D1 = [0, 0.88, 0.1, 0; 0.18, 0.07, 0.14, 0.1; 0.13, 0.15, 0.15, 0.04; 0.31, 0.18, 0.12, 0.27];
disp('D1 = ');
disp(D1);
disp('Test:');
disp('-----');
disp('moms = MarginalMomentsFromDMAP(D0, D1);:');
moms = MarginalMomentsFromDMAP(D0, D1);
disp('moms = ');
disp(moms);
assert(length(moms)==2*size(D0,1)-1&&CheckMoments(moms), 'MarginalMomentsFromDMAP returned wrong moments!');
disp('========================================')
disp('Testing BuTools function MarginalDistributionFromDRAP')
disp('Input:');
disp('------');
H0 = [0, 0, 0.13; 0, 0.6, 0.18; 0.31, 0.26, 0.02];
disp('H0 = ');
disp(H0);
H1 = [0, 1, -0.13; 0, 0.18, 0.04; 0.03, 0.09, 0.29];
disp('H1 = ');
disp(H1);
disp('Test:');
disp('-----');
disp('[a, A] = MarginalDistributionFromDRAP(H0, H1);:');
[a, A] = MarginalDistributionFromDRAP(H0, H1);
disp('a = ');
disp(a);
disp('A = ');
disp(A);
assert(length(a)==size(H0,1)&&CheckMGRepresentation(a, A), 'MarginalDistributionFromDRAP returned a wrong MG representation!');
disp('========================================')
disp('Testing BuTools function MarginalMomentsFromDRAP')
disp('Input:');
disp('------');
H0 = [0, 0, 0.13; 0, 0.6, 0.18; 0.31, 0.26, 0.02];
disp('H0 = ');
disp(H0);
H1 = [0, 1, -0.13; 0, 0.18, 0.04; 0.03, 0.09, 0.29];
disp('H1 = ');
disp(H1);
disp('Test:');
disp('-----');
disp('moms = MarginalMomentsFromDRAP(H0, H1);:');
moms = MarginalMomentsFromDRAP(H0, H1);
disp('moms = ');
disp(moms);
assert(length(moms)==2*size(H0,1)-1&&CheckMoments(moms), 'MarginalMomentsFromDRAP returned wrong moments!');
disp('========================================')
disp('Testing BuTools function MarginalDistributionFromDMMAP')
D0 = [0.34, 0, 0; 0.06, 0.05, 0.03; 0.11, 0.13, 0];
disp('D0 = ');
disp(D0);
D1 = [0.3, 0, 0; 0.16, 0.18, 0.05; 0.15, 0.04, 0.09];
disp('D1 = ');
disp(D1);
D2 = [0, 0.01, 0; 0.1, 0.07, 0.08; 0.13, 0.12, 0.13];
disp('D2 = ');
disp(D2);
D3 = [0.35, 0, 0; 0, 0.18, 0.04; 0.06, 0.03, 0.01];
disp('D3 = ');
disp(D3);
disp('Test:');
disp('-----');
disp('[a, A] = MarginalDistributionFromDMMAP({D0, D1, D2, D3});:');
[a, A] = MarginalDistributionFromDMMAP({D0, D1, D2, D3});
disp('a = ');
disp(a);
disp('A = ');
disp(A);
assert(length(a)==size(D0,1)&&CheckDPHRepresentation(a, A), 'MarginalDistributionFromDMMAP returned a wrong DPH representation!');
disp('========================================')
disp('Testing BuTools function MarginalMomentsFromDMMAP')
disp('Input:');
disp('------');
D0 = [0.34, 0, 0; 0.06, 0.05, 0.03; 0.11, 0.13, 0];
disp('D0 = ');
disp(D0);
D1 = [0.3, 0, 0; 0.16, 0.18, 0.05; 0.15, 0.04, 0.09];
disp('D1 = ');
disp(D1);
D2 = [0, 0.01, 0; 0.1, 0.07, 0.08; 0.13, 0.12, 0.13];
disp('D2 = ');
disp(D2);
D3 = [0.35, 0, 0; 0, 0.18, 0.04; 0.06, 0.03, 0.01];
disp('D3 = ');
disp(D3);
disp('Test:');
disp('-----');
disp('moms = MarginalMomentsFromDMMAP({D0, D1, D2, D3});:');
moms = MarginalMomentsFromDMMAP({D0, D1, D2, D3});
disp('moms = ');
disp(moms);
assert(length(moms)==2*size(D0,1)-1&&CheckMoments(moms), 'MarginalMomentsFromDMMAP returned wrong moments!');
disp('========================================')
disp('Testing BuTools function MarginalDistributionFromDMRAP')
disp('Input:');
disp('------');
H0 = [0.15, 0.2, 0.18; -0.23, 0.17, 0.22; 0.19, 0.15, 0.16];
disp('H0 = ');
disp(H0);
H1 = [0.01, 0.08, 0.16; 0.02, 0.2, 0.07; 0.02, 0.15, 0.17];
disp('H1 = ');
disp(H1);
H2 = [0.14, 0.07, 0.01; 0.19, 0.02, 0.34; 0.06, 0.1, 0];
disp('H2 = ');
disp(H2);
disp('Test:');
disp('-----');
disp('[a, A] = MarginalDistributionFromDMRAP({H0, H1, H2});:');
[a, A] = MarginalDistributionFromDMRAP({H0, H1, H2});
disp('a = ');
disp(a);
disp('A = ');
disp(A);
assert(length(a)==size(H0,1)&&CheckMGRepresentation(a, A), 'MarginalDistributionFromDMRAP returned a wrong MG representation!');
disp('========================================')
disp('Testing BuTools function MarginalMomentsFromDMRAP')
disp('Input:');
disp('------');
H0 = [0.15, 0.2, 0.18; -0.23, 0.17, 0.22; 0.19, 0.15, 0.16];
disp('H0 = ');
disp(H0);
H1 = [0.01, 0.08, 0.16; 0.02, 0.2, 0.07; 0.02, 0.15, 0.17];
disp('H1 = ');
disp(H1);
H2 = [0.14, 0.07, 0.01; 0.19, 0.02, 0.34; 0.06, 0.1, 0];
disp('H2 = ');
disp(H2);
disp('Test:');
disp('-----');
disp('moms = MarginalMomentsFromDMRAP({H0, H1, H2});:');
moms = MarginalMomentsFromDMRAP({H0, H1, H2});
disp('moms = ');
disp(moms);
assert(length(moms)==2*size(H0,1)-1&&CheckMoments(moms), 'MarginalMomentsFromDMRAP returned wrong moments!');
disp('========================================')
disp('Testing BuTools function LagCorrelationsFromDMAP')
disp('Input:');
disp('------');
D0 = [0, 0.02, 0, 0; 0, 0.17, 0.2, 0.14; 0.16, 0.17, 0.02, 0.18; 0, 0, 0, 0.12];
disp('D0 = ');
disp(D0);
D1 = [0, 0.88, 0.1, 0; 0.18, 0.07, 0.14, 0.1; 0.13, 0.15, 0.15, 0.04; 0.31, 0.18, 0.12, 0.27];
disp('D1 = ');
disp(D1);
disp('Test:');
disp('-----');
disp('corr = LagCorrelationsFromDMAP(D0, D1, 3);:');
corr = LagCorrelationsFromDMAP(D0, D1, 3);
disp('corr = ');
disp(corr);
assert(length(corr)==3&&all(corr<=1)&&all(corr>=-1), 'LagCorrelationsFromDMAP returned wrong autocorrelation coefficients!');
disp('========================================')
disp('Testing BuTools function LagCorrelationsFromDRAP')
disp('Input:');
disp('------');
H0 = [0, 0, 0.13; 0, 0.6, 0.18; 0.31, 0.26, 0.02];
disp('H0 = ');
disp(H0);
H1 = [0, 1, -0.13; 0, 0.18, 0.04; 0.03, 0.09, 0.29];
disp('H1 = ');
disp(H1);
disp('Test:');
disp('-----');
disp('corr = LagCorrelationsFromDRAP(H0, H1, 3);:');
corr = LagCorrelationsFromDRAP(H0, H1, 3);
disp('corr = ');
disp(corr);
assert(length(corr)==3&&all(corr<=1)&&all(corr>=-1), 'LagCorrelationsFromDRAP returned wrong autocorrelation coefficients!');
disp('========================================')
disp('Testing BuTools function LagkJointMomentsFromDMAP')
disp('Input:');
disp('------');
D0 = [0, 0.02, 0, 0; 0, 0.17, 0.2, 0.14; 0.16, 0.17, 0.02, 0.18; 0, 0, 0, 0.12];
disp('D0 = ');
disp(D0);
D1 = [0, 0.88, 0.1, 0; 0.18, 0.07, 0.14, 0.1; 0.13, 0.15, 0.15, 0.04; 0.31, 0.18, 0.12, 0.27];
disp('D1 = ');
disp(D1);
disp('Test:');
disp('-----');
disp('Nm = LagkJointMomentsFromDMAP(D0, D1, 4, 1);:');
Nm = LagkJointMomentsFromDMAP(D0, D1, 4, 1);
disp('Nm = ');
disp(Nm);
disp('moms = MarginalMomentsFromDMAP(D0, D1, 4);:');
moms = MarginalMomentsFromDMAP(D0, D1, 4);
disp('moms = ');
disp(moms);
cjm = zeros(1,3);
for i=1:1:3
    Nx = LagkJointMomentsFromDMAP(D0, D1, 1, i);
    cjm(i) = (Nx(2, 2)-moms(1)^2)/(moms(2)-moms(1)^2);
end
disp('Correlation from joint moments:');
disp(cjm);
disp('corr = LagCorrelationsFromDMAP(D0, D1, 3);:');
corr = LagCorrelationsFromDMAP(D0, D1, 3);
disp('corr = ');
disp(corr);
mNm1 = reshape(Nm(1, 2:end),1,numel(Nm(1, 2:end)));
mNm2 = reshape(Nm(2:end, 1),1,numel(Nm(2:end, 1)));
assert(all(all(Nm>0))&&norm(moms-mNm1)<10^-12&&norm(moms-mNm2)<10^-12&&norm(corr-cjm)<10^-12, 'Joint moment matrix is invalid!');
disp('========================================')
disp('Testing BuTools function LagkJointMomentsFromDRAP')
disp('Input:');
disp('------');
H0 = [0, 0, 0.13; 0, 0.6, 0.18; 0.31, 0.26, 0.02];
disp('H0 = ');
disp(H0);
H1 = [0, 1, -0.13; 0, 0.18, 0.04; 0.03, 0.09, 0.29];
disp('H1 = ');
disp(H1);
disp('Test:');
disp('-----');
disp('Nm = LagkJointMomentsFromDRAP(H0, H1, 4, 1);:');
Nm = LagkJointMomentsFromDRAP(H0, H1, 4, 1);
disp(length(Nm));
disp('moms = MarginalMomentsFromDRAP(H0, H1, 4);:');
moms = MarginalMomentsFromDRAP(H0, H1, 4);
disp('moms = ');
disp(moms);
cjm = zeros(1,3);
for i=1:1:3
    Nx = LagkJointMomentsFromDRAP(H0, H1, 1, i);
    cjm(i) = (Nx(2, 2)-moms(1)^2)/(moms(2)-moms(1)^2);
end
disp('Correlation from joint moments:');
disp(cjm);
disp('corr = LagCorrelationsFromDRAP(H0, H1, 3);:');
corr = LagCorrelationsFromDRAP(H0, H1, 3);
disp('corr = ');
disp(corr);
mNm1 = reshape(Nm(1, 2:end),1,numel(Nm(1, 2:end)));
mNm2 = reshape(Nm(2:end, 1),1,numel(Nm(2:end, 1)));
assert(all(all(Nm>0))&&norm(moms-mNm1)<10^-12&&norm(moms-mNm2)<10^-12&&norm(corr-cjm)<10^-12, 'Joint moment matrix is invalid!');
disp('========================================')
disp('Testing BuTools function LagkJointMomentsFromDMMAP')
disp('Input:');
disp('------');
D0 = [0.34, 0, 0; 0.06, 0.05, 0.03; 0.11, 0.13, 0];
disp('D0 = ');
disp(D0);
D1 = [0.3, 0, 0; 0.16, 0.18, 0.05; 0.15, 0.04, 0.09];
disp('D1 = ');
disp(D1);
D2 = [0, 0.01, 0; 0.1, 0.07, 0.08; 0.13, 0.12, 0.13];
disp('D2 = ');
disp(D2);
D3 = [0.35, 0, 0; 0, 0.18, 0.04; 0.06, 0.03, 0.01];
disp('D3 = ');
disp(D3);
disp('Test:');
disp('-----');
disp('Nm = LagkJointMomentsFromDMMAP({D0, D1, D2, D3}, 3, 1);:');
Nm = LagkJointMomentsFromDMMAP({D0, D1, D2, D3}, 3, 1);
disp(Nm{1});
disp(Nm{2});
disp(Nm{3});
assert(length(Nm)==3&&norm(Nm{1}+Nm{2}+Nm{3}-LagkJointMomentsFromDMAP(D0, D1+D2+D3, 3, 1))<10^-12, 'Joint moment matrix is invalid!');
disp('========================================')
disp('Testing BuTools function LagkJointMomentsFromDMRAP')
disp('Input:');
disp('------');
H0 = [0.15, 0.2, 0.18; -0.23, 0.17, 0.22; 0.19, 0.15, 0.16];
disp('H0 = ');
disp(H0);
H1 = [0.01, 0.08, 0.16; 0.02, 0.2, 0.07; 0.02, 0.15, 0.17];
disp('H1 = ');
disp(H1);
H2 = [0.14, 0.07, 0.01; 0.19, 0.02, 0.34; 0.06, 0.1, 0];
disp('H2 = ');
disp(H2);
disp('Test:');
disp('-----');
disp('Nm = LagkJointMomentsFromDMRAP({H0, H1, H2}, 3, 2);:');
Nm = LagkJointMomentsFromDMRAP({H0, H1, H2}, 3, 2);
disp(Nm{1});
disp(Nm{2});
assert(length(Nm)==2&&norm(Nm{1}+Nm{2}-LagkJointMomentsFromDRAP(H0, H1+H2, 3, 2))<10^-12, 'Joint moment matrix is invalid!');
disp('========================================')
disp('Testing BuTools function RandomDMAP')
disp('Test:');
disp('-----');
disp('[D0, D1] = RandomDMAP(4, 5.62, 10);:');
[D0, D1] = RandomDMAP(4, 5.62, 10);
disp('D0 = ');
disp(D0);
disp('D1 = ');
disp(D1);
disp('m = MarginalMomentsFromDMAP(D0, D1, 1);:');
m = MarginalMomentsFromDMAP(D0, D1, 1);
disp('m = ');
disp(m);
assert(CheckDMAPRepresentation(D0, D1), 'RandomDMAP failed to return a valid DMAP representation!');
assert(abs(m-5.62)<10^-14, 'RandomDMAP failed to match the given mean value!');
disp('========================================')
disp('Testing BuTools function RandomDMMAP')
disp('Test:');
disp('-----');
disp('Dm = RandomDMMAP(4, 3, 5.62, 10);:');
Dm = RandomDMMAP(4, 3, 5.62, 10);
disp(Dm{1});
disp(Dm{2});
disp(Dm{3});
disp(Dm{4});
disp('m = MarginalMomentsFromDMMAP(Dm, 1);:');
m = MarginalMomentsFromDMMAP(Dm, 1);
disp('m = ');
disp(m);
assert(CheckDMMAPRepresentation(Dm), 'RandomDMMAP failed to return a valid MMAP representation!');
assert(abs(m-5.62)<10^-14, 'RandomDMMAP failed to match the given mean value!');
disp('========================================')
disp('Testing BuTools function CheckDMAPRepresentation')
disp('Input:');
disp('------');
D0 = [0, 0.02, 0; 0, 0.17, 0.2; 0.16, 0.17, 0.02];
disp('D0 = ');
disp(D0);
D1 = [0, 0.88, 0.1, 0; 0.18, 0.07, 0.14, 0.1; 0.13, 0.15, 0.15, 0.04; 0.31, 0.18, 0.12, 0.27];
disp('D1 = ');
disp(D1);
disp('Test:');
disp('-----');
disp('flag = CheckDMAPRepresentation(D0, D1);:');
flag = CheckDMAPRepresentation(D0, D1);
disp('flag = ');
disp(flag);
assert(flag==false, 'CheckDMAPRepresentation failed to detect the incompatible shapes of D0 and D1!');
disp('Input:');
disp('------');
D0 = [0, 0.02, 0; 0, 0.17, 0.2; 0.16, 0.17, 0.02];
disp('D0 = ');
disp(D0);
D1 = [0, 0.88, 0.1; 0.18, 0.07, 0.14; 0.13, 0.15, 0.15];
disp('D1 = ');
disp(D1);
disp('Test:');
disp('-----');
disp('flag = CheckDMAPRepresentation(D0, D1);:');
flag = CheckDMAPRepresentation(D0, D1);
disp('flag = ');
disp(flag);
assert(flag==false, 'CheckDMAPRepresentation failed to detect invalid rowsums!');
disp('Input:');
disp('------');
D0 = [0, 0.02, 0, 0; 0, 0.17, 0.2, 0.14; 0.16, 0.17, 0.02, 0.18; 0, 0, 0, 0.12];
disp('D0 = ');
disp(D0);
D1 = [0, 0.88, 0.1, 0; 0.18, 0.07, 0.14, 0.1; 0.13, 0.15, 0.15, 0.04; 0.31, 0.18, 0.12, 0.27];
disp('D1 = ');
disp(D1);
disp('Test:');
disp('-----');
disp('flag = CheckDMAPRepresentation(D0, D1);:');
flag = CheckDMAPRepresentation(D0, D1);
disp('flag = ');
disp(flag);
assert(flag==true, 'CheckDMAPRepresentation failed to recognize a valid DMAP representation!');
disp('========================================')
disp('Testing BuTools function CheckDRAPRepresentation')
disp('Input:');
disp('------');
H0 = [0, 0, 0.13; 0, 0.6, 0.18; 0.31, 0.26, 0.02; 0.2, 0, 0];
disp('H0 = ');
disp(H0);
H1 = [0, 1., -0.13; 0, 0.18, 0.04; 0.03, 0.09, 0.29; 0, 0.8, 0];
disp('H1 = ');
disp(H1);
disp('Test:');
disp('-----');
disp('flag = CheckDRAPRepresentation(H0, H1);:');
flag = CheckDRAPRepresentation(H0, H1);
disp('flag = ');
disp(flag);
assert(flag==false, 'CheckDRAPRepresentation failed to detect the incompatible shapes of D0 and D1!');
disp('Input:');
disp('------');
H0 = [0.2, 0, 0.13; 0, 0.6, 0.18; 0.31, 0.26, 0.02];
disp('H0 = ');
disp(H0);
H1 = [0, 1., -0.13; 0, 0.18, 0.04; 0.03, 0.09, 0.29];
disp('H1 = ');
disp(H1);
disp('Test:');
disp('-----');
disp('flag = CheckDRAPRepresentation(H0, H1);:');
flag = CheckDRAPRepresentation(H0, H1);
disp('flag = ');
disp(flag);
assert(flag==false, 'CheckDRAPRepresentation failed to detect invalid rowsums!');
disp('Input:');
disp('------');
H0 = [-1., 0, 0; 0, -2., 2.; 0, 3., -3.];
disp('H0 = ');
disp(H0);
H1 = [0, 0, 1.; 0, -1., 1.; 1., 0, -1.];
disp('H1 = ');
disp(H1);
disp('Test:');
disp('-----');
disp('flag = CheckDRAPRepresentation(H0, H1);:');
flag = CheckDRAPRepresentation(H0, H1);
disp('flag = ');
disp(flag);
assert(flag==false, 'CheckDRAPRepresentation failed to detect invalid eigenvalues!');
disp('Input:');
disp('------');
H0 = [0, 0, 15.; 0, 0.6, 0.18; 0.31, 0.26, 0.02];
disp('H0 = ');
disp(H0);
H1 = [0, 1., -15.; 0, 0.18, 0.04; 0.03, 0.09, 0.29];
disp('H1 = ');
disp(H1);
disp('Test:');
disp('-----');
disp('flag = CheckDRAPRepresentation(H0, H1);:');
flag = CheckDRAPRepresentation(H0, H1);
disp('flag = ');
disp(flag);
assert(flag==false, 'CheckDRAPRepresentation failed to detect invalid eigenvalues!');
disp('Input:');
disp('------');
H0 = [0, 0.5, 0.1; 0, -1.4, 3.1; 0.67, 0, 0.4];
disp('H0 = ');
disp(H0);
H1 = [0, 0.4, 0; 0, -0.2, -0.5; 0.3, -0.7, 0.33];
disp('H1 = ');
disp(H1);
disp('Test:');
disp('-----');
disp('flag = CheckDRAPRepresentation(H0, H1);:');
flag = CheckDRAPRepresentation(H0, H1);
disp('flag = ');
disp(flag);
assert(flag==false, 'CheckDRAPRepresentation failed to detect invalid eigenvalues!');
disp('Input:');
disp('------');
H0 = [0, 0, 0.13; 0, 0.6, 0.18; 0.31, 0.26, 0.02];
disp('H0 = ');
disp(H0);
H1 = [0, 1., -0.13; 0, 0.18, 0.04; 0.03, 0.09, 0.29];
disp('H1 = ');
disp(H1);
disp('Test:');
disp('-----');
disp('flag = CheckDRAPRepresentation(H0, H1);:');
flag = CheckDRAPRepresentation(H0, H1);
disp('flag = ');
disp(flag);
assert(flag==true, 'CheckDRAPRepresentation failed to recognize a valid RAP representation!');
disp('========================================')
disp('Testing BuTools function CheckDMMAPRepresentation')
disp('Input:');
disp('------');
D0 = [0.34, 0, 0; 0.06, 0.05, 0.03; 0.11, 0.13, 0];
disp('D0 = ');
disp(D0);
D1 = [0.3, 0, 0; 0.16, 0.18, 0.05; 0.15, 0.04, 0.09];
disp('D1 = ');
disp(D1);
D2 = [0, 0.01, 0; 0.1, 0.07, 0.08; 0.13, 0.12, 0.13];
disp('D2 = ');
disp(D2);
D3 = [0.35, 0, 0; 0, 0.18, 0.04; 0.06, 0.03, 0.01];
disp('D3 = ');
disp(D3);
disp('Test:');
disp('-----');
disp('flag = CheckDMMAPRepresentation({D0, D1, D2, D3});:');
flag = CheckDMMAPRepresentation({D0, D1, D2, D3});
disp('flag = ');
disp(flag);
assert(flag==true, 'CheckDMMAPRepresentation failed to recognize a valid DMMAP representation!');
disp('========================================')
disp('Testing BuTools function CheckDMRAPRepresentation')
disp('Input:');
disp('------');
H0 = [0.15, 0.2, 0.18; -0.23, 0.17, 0.22; 0.19, 0.15, 0.16];
disp('H0 = ');
disp(H0);
H1 = [0.01, 0.08, 0.16; 0.02, 0.2, 0.07; 0.02, 0.15, 0.17];
disp('H1 = ');
disp(H1);
H2 = [0.14, 0.07, 0.01; 0.19, 0.02, 0.34; 0.06, 0.1, 0];
disp('H2 = ');
disp(H2);
disp('Test:');
disp('-----');
disp('flag = CheckDMRAPRepresentation({H0, H1, H2});:');
flag = CheckDMRAPRepresentation({H0, H1, H2});
disp('flag = ');
disp(flag);
assert(flag==true, 'CheckDMRAPRepresentation failed to recognize a valid DMRAP representation!');
disp('========================================')
disp('Testing BuTools function DRAPFromMoments')
disp('Input:');
disp('------');
G0 = [0, 0.02, 0, 0; 0, 0.17, 0.2, 0.14; 0.16, 0.17, 0.02, 0.18; 0, 0, 0, 0.12];
disp('G0 = ');
disp(G0);
G1 = [0, 0.88, 0.1, 0; 0.18, 0.07, 0.14, 0.1; 0.13, 0.15, 0.15, 0.04; 0.31, 0.18, 0.12, 0.27];
disp('G1 = ');
disp(G1);
disp('moms = MarginalMomentsFromDRAP(G0, G1, 5);:');
moms = MarginalMomentsFromDRAP(G0, G1, 5);
disp('moms = ');
disp(moms);
disp('Nm = LagkJointMomentsFromDRAP(G0, G1, 2, 1);:');
Nm = LagkJointMomentsFromDRAP(G0, G1, 2, 1);
disp('Nm = ');
disp(Nm);
disp('Test:');
disp('-----');
disp('[H0, H1] = DRAPFromMoments(moms, Nm);:');
[H0, H1] = DRAPFromMoments(moms, Nm);
disp('H0 = ');
disp(H0);
disp('H1 = ');
disp(H1);
disp('rmoms = MarginalMomentsFromDRAP(H0, H1, 5);:');
rmoms = MarginalMomentsFromDRAP(H0, H1, 5);
disp('rmoms = ');
disp(rmoms);
disp('rNm = LagkJointMomentsFromDRAP(H0, H1, 2, 1);:');
rNm = LagkJointMomentsFromDRAP(H0, H1, 2, 1);
disp('rNm = ');
disp(rNm);
assert(norm(moms-rmoms)<10^-11&&norm(Nm-rNm)<10^-12, 'The moments and joint moments returned by RAPFromMoments are not the same as given!');
disp('========================================')
disp('Testing BuTools function DMRAPFromMoments')
disp('Input:');
disp('------');
G0 = [0.34, 0, 0; 0.06, 0.05, 0.03; 0.11, 0.13, 0];
disp('G0 = ');
disp(G0);
G1 = [0.3, 0, 0; 0.16, 0.18, 0.05; 0.15, 0.04, 0.09];
disp('G1 = ');
disp(G1);
G2 = [0, 0.01, 0; 0.1, 0.07, 0.08; 0.13, 0.12, 0.13];
disp('G2 = ');
disp(G2);
G3 = [0.35, 0, 0; 0, 0.18, 0.04; 0.06, 0.03, 0.01];
disp('G3 = ');
disp(G3);
disp('G = {G0, G1, G2, G3};:');
G = {G0, G1, G2, G3};
disp('moms = MarginalMomentsFromDMRAP(G, 5);:');
moms = MarginalMomentsFromDMRAP(G, 5);
disp('moms = ');
disp(moms);
disp('Nm = LagkJointMomentsFromDMRAP(G, 2, 1);:');
Nm = LagkJointMomentsFromDMRAP(G, 2, 1);
disp('[Nm1, Nm2, Nm3] = Nm{:};:');
[Nm1, Nm2, Nm3] = Nm{:};
disp('Nm1 = ');
disp(Nm1);
disp('Nm2 = ');
disp(Nm2);
disp('Nm3 = ');
disp(Nm3);
disp('Test:');
disp('-----');
disp('H = DMRAPFromMoments(moms, Nm);:');
H = DMRAPFromMoments(moms, Nm);
disp('H{1}:');
disp(H{1});
disp('H{2}:');
disp(H{2});
disp('H{3}:');
disp(H{3});
disp('H{4}:');
disp(H{4});
BuToolsCheckPrecision = 10.^-10;
disp('rmoms = MarginalMomentsFromDMRAP(H, 5);:');
rmoms = MarginalMomentsFromDMRAP(H, 5);
disp('rmoms = ');
disp(rmoms);
disp('rNm = LagkJointMomentsFromDMRAP(H, 2, 1);:');
rNm = LagkJointMomentsFromDMRAP(H, 2, 1);
disp('[rNm1, rNm2, rNm3] = rNm{:};:');
[rNm1, rNm2, rNm3] = rNm{:};
disp('rNm1 = ');
disp(rNm1);
disp('rNm2 = ');
disp(rNm2);
disp('rNm3 = ');
disp(rNm3);
disp('norm(moms-rmoms):');
disp(norm(moms-rmoms));
assert(norm(moms-rmoms)<10^-9&&norm(Nm1-rNm1)<10^-9&&norm(Nm2-rNm2)<10^-9&&norm(Nm3-rNm3)<10^-9, 'The moments and joint moments returned by DMRAPFromMoments are not the same as given!');
disp('========================================')
disp('Testing BuTools function DMAPFromDRAP')
disp('Input:');
disp('------');
H0 = [0, 0, 0.13; 0, 0.6, 0.18; 0.31, 0.26, 0.02];
disp('H0 = ');
disp(H0);
H1 = [0, 1, -0.13; 0, 0.18, 0.04; 0.03, 0.09, 0.29];
disp('H1 = ');
disp(H1);
disp('Test:');
disp('-----');
disp('[D0, D1] = DMAPFromDRAP(H0, H1);:');
[D0, D1] = DMAPFromDRAP(H0, H1);
disp('D0 = ');
disp(D0);
disp('D1 = ');
disp(D1);
disp('err = norm(LagkJointMomentsFromDRAP(D0, D1, 3, 1)-LagkJointMomentsFromDRAP(H0, H1, 3, 1));:');
err = norm(LagkJointMomentsFromDRAP(D0, D1, 3, 1)-LagkJointMomentsFromDRAP(H0, H1, 3, 1));
disp('err = ');
disp(err);
assert(err<10^-10, 'The DMAP returned by DMAPFromDRAP is not similar to the input!');
assert(CheckDMAPRepresentation(D0, D1), 'The result of DMAPFromDRAP is not a DMAP, as it should be!');
disp('========================================')
disp('Testing BuTools function DMMAPFromDMRAP')
disp('Input:');
disp('------');
H0 = [0.15, 0.2, 0.18; -0.20, 0.17, 0.22; 0.19, 0.15, 0.16];
disp('H0 = ');
disp(H0);
H1 = [0.01, 0.08, 0.16; 0.02, 0.2, 0.07; 0.02, 0.15, 0.17];
disp('H1 = ');
disp(H1);
H2 = [0.14, 0.07, 0.01; 0.19, 0.02, 0.31; 0.06, 0.1, 0.];
disp('H2 = ');
disp(H2);
H = {H0, H1, H2};
disp('moms = MarginalMomentsFromDMRAP(H);:');
moms = MarginalMomentsFromDMRAP(H);
disp('moms = ');
disp(moms);
disp('jmom = LagkJointMomentsFromDMRAP(H, 3, 1);:');
jmom = LagkJointMomentsFromDMRAP(H, 3, 1);
disp('Test:');
disp('-----');
disp('G = DMMAPFromDMRAP(H);:');
G = DMMAPFromDMRAP(H);
disp(G{1});
disp(G{2});
disp(G{3});
disp('rmoms = MarginalMomentsFromDMMAP(G);:');
rmoms = MarginalMomentsFromDMMAP(G);
disp('rmoms = ');
disp(rmoms);
disp('rjmom = LagkJointMomentsFromDMMAP(G, 3, 1);:');
rjmom = LagkJointMomentsFromDMMAP(G, 3, 1);
disp('err = norm(rjmom{1}-jmom{1})+norm(rjmom{2}-jmom{2});:');
err = norm(rjmom{1}-jmom{1})+norm(rjmom{2}-jmom{2});
disp('err = ');
disp(err);
assert(err<10^-12, 'The DMMAP returned by DMMAPFromDMRAP is not similar to the input!');
assert(CheckDMMAPRepresentation(G), 'The result of DMMAPFromDMRAP is not a DMMAP, as it should be!');
disp('========================================')
disp('Testing BuTools function CanonicalFromDMAP2')
disp('Input:');
disp('------');
D0 = [0.46, 0.28; 0.35, 0.23];
disp('D0 = ');
disp(D0);
D1 = [0.08, 0.18; 0.14, 0.28];
disp('D1 = ');
disp(D1);
disp('Test:');
disp('-----');
disp('[H0, H1] = CanonicalFromDMAP2(D0, D1);:');
[H0, H1] = CanonicalFromDMAP2(D0, D1);
disp('H0 = ');
disp(H0);
disp('H1 = ');
disp(H1);
Cm = SimilarityMatrix(H0, D0);
err1 = norm(H0*Cm-Cm*D0);
err2 = norm(H1*Cm-Cm*D1);
disp('Transformation errors:');
disp(max(err1, err2));
assert(CheckDMAPRepresentation(H0, H1), 'The result of CanonicalFromDMAP2 is not a valid DMAP representation!');
assert(max(err1, err2)<10^-12, 'The DMAP returned by CanonicalFromDMAP2 is not similar to the input!');
disp('Input:');
disp('------');
D0 = [0.26, 0.28; 0.35, 0.23];
disp('D0 = ');
disp(D0);
D1 = [0.28, 0.18; 0.14, 0.28];
disp('D1 = ');
disp(D1);
disp('Test:');
disp('-----');
disp('[H0, H1] = CanonicalFromDMAP2(D0, D1);:');
[H0, H1] = CanonicalFromDMAP2(D0, D1);
disp('H0 = ');
disp(H0);
disp('H1 = ');
disp(H1);
Cm = SimilarityMatrix(H0, D0);
err1 = norm(H0*Cm-Cm*D0);
err2 = norm(H1*Cm-Cm*D1);
disp('Transformation errors:');
disp(max(err1, err2));
assert(CheckDMAPRepresentation(H0, H1), 'The result of CanonicalFromDMAP2 is not a valid DMAP representation!');
assert(max(err1, err2)<10^-12, 'The DMAP returned by CanonicalFromDMAP2 is not similar to the input!');
disp('Input:');
disp('------');
D0 = [0.14, 0.34; 0.35, 0.23];
disp('D0 = ');
disp(D0);
D1 = [0.22, 0.3; 0.28, 0.14];
disp('D1 = ');
disp(D1);
disp('Test:');
disp('-----');
disp('[H0, H1] = CanonicalFromDMAP2(D0, D1);:');
[H0, H1] = CanonicalFromDMAP2(D0, D1);
disp('H0 = ');
disp(H0);
disp('H1 = ');
disp(H1);
Cm = SimilarityMatrix(H0, D0);
err1 = norm(H0*Cm-Cm*D0);
err2 = norm(H1*Cm-Cm*D1);
disp('Transformation errors:');
disp(max(err1, err2));
assert(CheckDMAPRepresentation(H0, H1), 'The result of CanonicalFromDMAP2 is not a valid DMAP representation!');
assert(max(err1, err2)<10^-12, 'The DMAP returned by CanonicalFromDMAP2 is not similar to the input!');
disp('========================================')
disp('Testing BuTools function DMAP2FromMoments')
disp('Input:');
disp('------');
D0 = [0.2, 0.7; 0.6, 0.1];
disp('D0 = ');
disp(D0);
D1 = [0.09, 0.01; 0.2, 0.1];
disp('D1 = ');
disp(D1);
disp('moms = MarginalMomentsFromDMAP(D0, D1, 3);:');
moms = MarginalMomentsFromDMAP(D0, D1, 3);
disp('moms = ');
disp(moms);
disp('corr = LagCorrelationsFromDMAP(D0, D1, 1);:');
corr = LagCorrelationsFromDMAP(D0, D1, 1);
disp('corr = ');
disp(corr);
disp('Test:');
disp('-----');
disp('[D0, D1] = DMAP2FromMoments(moms, corr);:');
[D0, D1] = DMAP2FromMoments(moms, corr);
disp('D0 = ');
disp(D0);
disp('D1 = ');
disp(D1);
disp('rmoms = MarginalMomentsFromDMAP(D0, D1, 3);:');
rmoms = MarginalMomentsFromDMAP(D0, D1, 3);
disp('rmoms = ');
disp(rmoms);
disp('rcorr = LagCorrelationsFromDMAP(D0, D1, 1);:');
rcorr = LagCorrelationsFromDMAP(D0, D1, 1);
disp('rcorr = ');
disp(rcorr);
assert(CheckDMAPRepresentation(D0, D1), 'DMAP2FromMoments returned an invalid DMAP representation!');
assert(norm(moms-rmoms)<10^-11&&abs(corr-rcorr)<10^-11, 'The moments and the correlation returned by DMAP2FromMoments are not the same as given!');
disp('========================================')
disp('Testing BuTools function SamplesFromDMAP')
disp('Input:');
disp('------');
D0 = [0, 0.02, 0, 0; 0, 0.17, 0.2, 0.14; 0.16, 0.17, 0.02, 0.18; 0, 0, 0, 0.12];
disp('D0 = ');
disp(D0);
D1 = [0, 0.88, 0.1, 0; 0.18, 0.07, 0.14, 0.1; 0.13, 0.15, 0.15, 0.04; 0.31, 0.18, 0.12, 0.27];
disp('D1 = ');
disp(D1);
disp('Test:');
disp('-----');
disp('x = SamplesFromDMAP(D0, D1, 10000);:');
x = SamplesFromDMAP(D0, D1, 10000);
disp('mt = MarginalMomentsFromTrace(x, 3);:');
mt = MarginalMomentsFromTrace(x, 3);
disp('mt = ');
disp(mt);
disp('mm = MarginalMomentsFromDMAP(D0, D1, 3);:');
mm = MarginalMomentsFromDMAP(D0, D1, 3);
disp('mm = ');
disp(mm);
disp('========================================')
disp('Testing BuTools function SamplesFromDMMAP')
disp('Input:');
disp('------');
D0 = [0.34, 0, 0; 0.06, 0.05, 0.03; 0.11, 0.13, 0];
disp('D0 = ');
disp(D0);
D1 = [0.3, 0, 0; 0.16, 0.18, 0.05; 0.15, 0.04, 0.09];
disp('D1 = ');
disp(D1);
D2 = [0, 0.01, 0; 0.1, 0.07, 0.08; 0.13, 0.12, 0.13];
disp('D2 = ');
disp(D2);
D3 = [0.35, 0, 0; 0, 0.18, 0.04; 0.06, 0.03, 0.01];
disp('D3 = ');
disp(D3);
Dm = {D0, D1, D2, D3};
disp('Test:');
disp('-----');
disp('x = SamplesFromDMMAP(Dm, 10000);:');
x = SamplesFromDMMAP(Dm, 10000);
disp('mt = MarginalMomentsFromTrace(x(1:end, 1), 3);:');
mt = MarginalMomentsFromTrace(x(1:end, 1), 3);
disp('mt = ');
disp(mt);
disp('mm = MarginalMomentsFromDMMAP(Dm, 3);:');
mm = MarginalMomentsFromDMMAP(Dm, 3);
disp('mm = ');
disp(mm);

